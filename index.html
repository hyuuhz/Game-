<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Maze of Our Love ❤️</title>

<style>
html,body{
  margin:0;
  padding:0;
  background:black;
  overflow:hidden;
  touch-action:none;
}
canvas{
  position:absolute;
  top:0;left:0;
}
.control{
  position:absolute;
  width:90px;
  height:90px;
  border-radius:50%;
  background:rgba(255,255,255,.15);
  border:2px solid rgba(255,255,255,.3);
  z-index:10;
}
#joy{left:20px;bottom:20px;}
#shoot{right:20px;bottom:20px;}
#reload{
  right:140px;
  bottom:20px;
  color:white;
  text-align:center;
  line-height:90px;
  font-family:Arial;
}
</style>
</head>

<body>

<canvas id="game"></canvas>

<div id="joy" class="control"></div>
<div id="reload" class="control">R</div>
<div id="shoot" class="control"></div>

<script>
/* ================= CANVAS ================= */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const DPR = window.devicePixelRatio || 1;

function resize(){
  canvas.width = innerWidth * DPR;
  canvas.height = innerHeight * DPR;
  canvas.style.width = innerWidth + "px";
  canvas.style.height = innerHeight + "px";
  ctx.setTransform(DPR,0,0,DPR,0,0);
}
resize();
addEventListener("resize", resize);

/* ================= LOAD ================= */
const load = src => { const i = new Image(); i.src = src; return i; };

/* ================= HERO SPRITES ================= */
const heroSprites = {
 idle:{ img:load("sprites/hero/cat_idle.png"), frames:5 },
 move:{ img:load("sprites/hero/cat_move.png"), frames:8 },
 hurt:{ img:load("sprites/hero/cat_hurt.png"), frames:4 },
 noammo:{ img:load("sprites/hero/cat_noammo.png"), frames:5 },
 reload:{ img:load("sprites/hero/cat_reload.png"), frames:41 },
 shoot:{ img:load("sprites/hero/cat_shooting.png"), frames:13 }
};

/* ================= ENEMY SPRITES ================= */
const enemySprites = {
 idle:{ img:load("sprites/enemy/enemy_idle.png"), frames:4 },
 fly:{ img:load("sprites/enemy/enemy_fly.png"), frames:4 },
 attack:{ img:load("sprites/enemy/enemy_attack.png"), frames:8 },
 hurt:{ img:load("sprites/enemy/enemy_hurt.png"), frames:4 },
 death:{ img:load("sprites/enemy/enemy_death.png"), frames:6 },
 projectile:{ img:load("sprites/enemy/enemy_projectile.png"), frames:1 }
};

const heartImg = load("sprites/items/heart.png");

/* ================= HERO ================= */
const hero = {
 x:100,y:100,w:64,h:64,
 speed:3,
 life:5,maxLife:5,
 ammo:10,maxAmmo:10,
 state:"idle",
 frame:0,tick:0,
 hurtTimer:0
};

/* ================= GAME STATE ================= */
let level = 1;
let enemies = [];
let heroBullets = [];
let enemyBullets = [];
let heart = null;

/* ================= LABYRINTH ================= */
const walls = [
 {x:200,y:80,w:20,h:300},
 {x:400,y:200,w:20,h:300},
 {x:600,y:80,w:20,h:300}
];

/* ================= CONTROLS ================= */
let moveX=0, moveY=0;
const joy = document.getElementById("joy");

joy.ontouchmove = e=>{
  const t = e.touches[0];
  moveX = Math.sign(t.clientX - 80);
  moveY = Math.sign(t.clientY - (innerHeight - 80));
};
joy.ontouchend = ()=>moveX=moveY=0;

document.getElementById("shoot").ontouchstart = shoot;
document.getElementById("reload").ontouchstart = ()=>{
  hero.state="reload";
  hero.frame=0;
  hero.ammo = hero.maxAmmo;
};

/* ================= SPAWN ================= */
function spawnLevel(){
  enemies=[];
  enemyBullets=[];
  heroBullets=[];
  for(let i=0;i<level+1;i++){
    enemies.push({
      x:500+i*80,
      y:150+i*60,
      w:64,h:64,
      life:5,
      state:"fly",
      frame:0,tick:0,
      cooldown:120
    });
  }
  heart={x:350,y:250,w:32,h:32};
}
spawnLevel();

/* ================= LOOP ================= */
function loop(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  update();
  draw();
  requestAnimationFrame(loop);
}
loop();

/* ================= UPDATE ================= */
function update(){
  hero.x+=moveX*hero.speed;
  hero.y+=moveY*hero.speed;

  hero.state = (moveX||moveY) ? "move" : "idle";

  enemies.forEach((e,ei)=>{
    if(e.life<=0) return;

    const dx = hero.x - e.x;
    const dy = hero.y - e.y;
    const d = Math.hypot(dx,dy);

    if(d<300){
      e.x+=Math.sign(dx)*1.4;
      e.y+=Math.sign(dy)*1.4;
      e.state="fly";
    }

    e.cooldown--;
    if(e.cooldown<=0){
      enemyBullets.push({
        x:e.x+32,y:e.y+32,
        vx:Math.sign(dx)*4,
        vy:Math.sign(dy)*4,
        w:16,h:16
      });
      e.cooldown=120;
    }

    if(hit(e,hero) && hero.hurtTimer<=0){
      hero.life--;
      hero.state="hurt";
      hero.hurtTimer=30;
      if(hero.life<=0){
        hero.life=hero.maxLife;
        hero.ammo=hero.maxAmmo;
        spawnLevel();
      }
    }
  });

  if(hero.hurtTimer>0) hero.hurtTimer--;

  heroBullets.forEach((b,i)=>{
    b.x+=b.vx;
    enemies.forEach((e,ei)=>{
      if(e.life>0 && hit(b,e)){
        e.life--;
        heroBullets.splice(i,1);
        if(e.life<=0) e.state="death";
      }
    });
  });

  enemyBullets.forEach((b,i)=>{
    b.x+=b.vx;
    b.y+=b.vy;
    if(hit(b,hero)){
      hero.life--;
      enemyBullets.splice(i,1);
    }
  });

  if(heart && hit(hero,heart)){
    hero.life=Math.min(hero.maxLife,hero.life+1);
    heart=null;
  }

  if(enemies.every(e=>e.life<=0)){
    level++;
    if(level>5){
      alert("Happy Birthday ❤️ I love you forever!");
      level=1;
    }
    spawnLevel();
  }
}

/* ================= DRAW ================= */
function draw(){
  drawLabyrinth();
  drawHeart();
  drawHero();
  drawEnemies();
  drawBullets();
  drawUI();
}

function drawAnim(sprite,obj){
  obj.tick++;
  if(obj.tick>8){
    obj.frame=(obj.frame+1)%sprite.frames;
    obj.tick=0;
  }
  ctx.drawImage(
    sprite.img,
    obj.frame*64,0,64,64,
    obj.x,obj.y,64,64
  );
}

function drawHero(){
  drawAnim(heroSprites[hero.state],hero);
}

function drawEnemies(){
  enemies.forEach(e=>{
    if(e.life>0) drawAnim(enemySprites[e.state],e);
  });
}

function drawBullets(){
  ctx.fillStyle="yellow";
  heroBullets.forEach(b=>ctx.fillRect(b.x,b.y,6,4));
  enemyBullets.forEach(b=>{
    ctx.drawImage(enemySprites.projectile.img,b.x,b.y,16,16);
  });
}

function drawLabyrinth(){
  ctx.fillStyle="#333";
  walls.forEach(w=>ctx.fillRect(w.x,w.y,w.w,w.h));
}

function drawHeart(){
  if(heart) ctx.drawImage(heartImg,heart.x,heart.y,32,32);
}

function drawUI(){
  ctx.fillStyle="red";
  ctx.fillRect(20,20,hero.life*30,10);
  ctx.fillStyle="yellow";
  ctx.fillRect(20,40,hero.ammo*15,10);
}

/* ================= ACTIONS ================= */
function shoot(){
  if(hero.ammo<=0){
    hero.state="noammo";
    return;
  }
  hero.state="shoot";
  heroBullets.push({
    x:hero.x+32,y:hero.y+32,
    vx:6,vy:0,w:6,h:4
  });
  hero.ammo--;
}

function hit(a,b){
  return a.x<b.x+b.w && a.x+a.w>b.x && a.y<b.y+b.h && a.y+a.h>b.y;
}
</script>

</body>
</html>
