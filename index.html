<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Labirinto Shooter</title>
<script src="https://cdn.jsdelivr.net/npm/p5@1.9.3/lib/p5.min.js"></script>
<style>
body{margin:0;overflow:hidden;background:black;}
</style>
</head>
<body>

<script>
/* ================= CONFIG ================= */
const TILE = 60;
let cols, rows;
let map;
let player;
let enemies=[];
let bullets=[];
let door=null;
let life=5;
let ammo=10;
let maxAmmo=10;
let stage=1;
let gameOver=false;

/* ================= MAPA (LABIRINTO REAL) ================= */
function generateMap(){
  map=[
    "111111111111",
    "100000000001",
    "101111011101",
    "101000010001",
    "101011110101",
    "100010000001",
    "101110111101",
    "100000000001",
    "111111111111"
  ];
}

/* ================= SETUP ================= */
function setup(){
  createCanvas(windowWidth,windowHeight);
  generateMap();
  player={x:1,y:1};
  spawnEnemies();
}

/* ================= INIMIGOS ================= */
function spawnEnemies(){
  enemies=[];
  enemies.push({x:10,y:6,life:3});
  enemies.push({x:8,y:3,life:3});
}

/* ================= DRAW ================= */
function draw(){
  background(0);

  if(gameOver){
    fill(255,0,0);
    textSize(40);
    textAlign(CENTER);
    text("GAME OVER",width/2,height/2);
    return;
  }

  drawMap();
  movePlayer();
  drawPlayer();
  drawEnemies();
  drawBullets();
  drawDoor();
  drawHUD();
}

/* ================= MAPA ================= */
function drawMap(){
  for(let y=0;y<map.length;y++){
    for(let x=0;x<map[y].length;x++){
      if(map[y][x]==="1"){
        fill(120);
        rect(x*TILE,y*TILE,TILE,TILE);
      }
    }
  }
}

/* ================= PLAYER ================= */
function movePlayer(){
  let nx=player.x;
  let ny=player.y;

  if(keyIsDown(87)) ny--;
  if(keyIsDown(83)) ny++;
  if(keyIsDown(65)) nx--;
  if(keyIsDown(68)) nx++;

  if(map[ny][nx]==="0"){
    player.x=nx;
    player.y=ny;
  }
}

function drawPlayer(){
  fill(0,255,0);
  rect(player.x*TILE+10,player.y*TILE+10,40,40);
}

/* ================= TIRO ================= */
function mousePressed(){
  if(ammo<=0) return;
  ammo--;
  bullets.push({
    x:player.x,
    y:player.y,
    dx:mouseX>width/2?1:-1,
    dy:mouseY>height/2?1:-1
  });
}

function drawBullets(){
  for(let i=bullets.length-1;i>=0;i--){
    let b=bullets[i];
    b.x+=b.dx*0.2;
    b.y+=b.dy*0.2;

    if(map[Math.floor(b.y)][Math.floor(b.x)]==="1"){
      bullets.splice(i,1);
      continue;
    }

    fill(255,255,0);
    ellipse(b.x*TILE+30,b.y*TILE+30,8);

    for(let e of enemies){
      if(dist(b.x,b.y,e.x,e.y)<0.5){
        e.life--;
        bullets.splice(i,1);
        break;
      }
    }
  }
}

/* ================= INIMIGOS ================= */
function drawEnemies(){
  for(let i=enemies.length-1;i>=0;i--){
    let e=enemies[i];
    let dx=Math.sign(player.x-e.x);
    let dy=Math.sign(player.y-e.y);

    if(map[e.y][e.x+dx]==="0") e.x+=dx*0.02;
    if(map[e.y+dy][e.x]==="0") e.y+=dy*0.02;

    fill(255,0,0);
    rect(e.x*TILE+15,e.y*TILE+15,30,30);

    if(dist(player.x,player.y,e.x,e.y)<0.6){
      life--;
      if(life<=0){
        life=0;
        gameOver=true;
      }
    }

    if(e.life<=0){
      enemies.splice(i,1);
    }
  }

  if(enemies.length===0 && !door){
    door={x:10,y:1};
  }
}

/* ================= PORTA ================= */
function drawDoor(){
  if(!door) return;
  fill(0,0,255);
  rect(door.x*TILE+10,door.y*TILE+10,40,40);

  if(player.x===door.x && player.y===door.y){
    stage++;
    ammo=maxAmmo;
    door=null;
    spawnEnemies();
  }
}

/* ================= RECARREGAR ================= */
function keyPressed(){
  if(key==="r"||key==="R"){
    ammo=maxAmmo;
  }
}

/* ================= HUD ================= */
function drawHUD(){
  fill(255);
  textSize(16);
  text("â¤ï¸ Vida: "+life,10,20);
  text("ðŸ”« Ammo: "+ammo+"/"+maxAmmo,10,40);
  text("Stage: "+stage,10,60);
}
</script>

</body>
</html>
