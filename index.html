<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Eternal Ember</title>
<script src="https://cdn.jsdelivr.net/npm/p5@1.9.3/lib/p5.min.js"></script>
<style>
body{margin:0;overflow:hidden;background:black}
</style>
</head>
<body>

<script>
/* =====================
   CONFIG
===================== */
const TILE = 40;
const MAP = [
  [1,1,1,1,1,1,1,1,1,1,1,1,1,1],
  [1,0,0,0,0,1,0,0,0,0,0,0,0,1],
  [1,0,1,1,0,1,0,1,1,1,1,1,0,1],
  [1,0,1,0,0,0,0,0,0,0,0,1,0,1],
  [1,0,1,0,1,1,1,1,1,1,0,1,0,1],
  [1,0,0,0,0,0,0,0,0,1,0,0,0,1],
  [1,1,1,1,1,1,1,1,0,1,1,1,0,1],
  [1,0,0,0,0,0,0,1,0,0,0,0,0,1],
  [1,0,1,1,1,1,0,1,1,1,1,1,0,1],
  [1,0,0,0,0,0,0,0,0,0,0,0,0,1],
  [1,1,1,1,1,1,1,1,1,1,1,1,1,1]
];

const MAP_W = MAP[0].length * TILE;
const MAP_H = MAP.length * TILE;

/* =====================
   ESTADOS
===================== */
const MENU=0, PLAY=1, GAMEOVER=2;
let state = MENU;

/* =====================
   PLAYER / CHECKPOINT
===================== */
let player;
let checkpoint = {x: TILE*1.5, y: TILE*1.5};
let life = 10;
let level = 1;

/* =====================
   SETUP
===================== */
function setup(){
  createCanvas(windowWidth, windowHeight);
  resetPlayer();
}

/* =====================
   RESET
===================== */
function resetPlayer(){
  player = {
    x: checkpoint.x,
    y: checkpoint.y,
    w: 30,
    h: 30,
    speed: 3
  };
  life = 10;
}

/* =====================
   DRAW
===================== */
function draw(){
  background(0);

  if(state===MENU){
    drawMenu();
    return;
  }

  if(state===GAMEOVER){
    drawGameOver();
    return;
  }

  updatePlayer();
  drawMap();
  drawPlayer();
  drawHUD();
}

/* =====================
   MENU
===================== */
function drawMenu(){
  fill(255);
  textAlign(CENTER,CENTER);
  textSize(40);
  text("ETERNAL EMBER", width/2, height/2-40);
  textSize(18);
  text("Clique para começar", width/2, height/2+20);
}

/* =====================
   GAME OVER
===================== */
function drawGameOver(){
  fill(255,0,0);
  textAlign(CENTER,CENTER);
  textSize(40);
  text("GAME OVER", width/2, height/2);
  textSize(18);
  text("Voltando ao checkpoint...", width/2, height/2+40);
}

/* =====================
   PLAYER
===================== */
function updatePlayer(){
  let nx = player.x;
  let ny = player.y;

  if(keyIsDown(65)) nx -= player.speed;
  if(keyIsDown(68)) nx += player.speed;
  if(keyIsDown(87)) ny -= player.speed;
  if(keyIsDown(83)) ny += player.speed;

  if(!hitWall(nx, player.y)) player.x = nx;
  if(!hitWall(player.x, ny)) player.y = ny;
}

/* =====================
   COLISÃO
===================== */
function hitWall(x,y){
  let left = floor((x-player.w/2)/TILE);
  let right = floor((x+player.w/2)/TILE);
  let top = floor((y-player.h/2)/TILE);
  let bottom = floor((y+player.h/2)/TILE);

  return MAP[top]?.[left]===1 ||
         MAP[top]?.[right]===1 ||
         MAP[bottom]?.[left]===1 ||
         MAP[bottom]?.[right]===1;
}

/* =====================
   MAPA
===================== */
function drawMap(){
  for(let y=0;y<MAP.length;y++){
    for(let x=0;x<MAP[0].length;x++){
      if(MAP[y][x]===1){
        fill(120);
        rect(x*TILE,y*TILE,TILE,TILE);
      }
    }
  }
}

/* =====================
   PLAYER DRAW
===================== */
function drawPlayer(){
  fill(0,255,0);
  rectMode(CENTER);
  rect(player.x, player.y, player.w, player.h);
}

/* =====================
   HUD
===================== */
function drawHUD(){
  fill(255);
  textSize(14);
  text("Vida: "+life,10,20);
  text("Fase: "+level,10,40);
}

/* =====================
   INPUT
===================== */
function mousePressed(){
  if(state===MENU){
    state=PLAY;
  }
}

function keyPressed(){
  if(keyCode===ESCAPE && state===PLAY){
    state=MENU;
  }
}

/* =====================
   MORTE
===================== */
function loseLife(){
  life--;
  if(life<=0){
    state=GAMEOVER;
    setTimeout(()=>{
      resetPlayer();
      state=MENU;
    },1500);
  }
}

/* =====================
   RESIZE
===================== */
function windowResized(){
  resizeCanvas(windowWidth,windowHeight);
}
</script>

</body>
</html>
