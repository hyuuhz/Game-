<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>üíñ Eternal Ember üíñ</title>
  <script src="https://cdn.jsdelivr.net/npm/p5@1.9.3/lib/p5.min.js"></script>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: black;
    }
    canvas {
      display: block;
    }
  </style>
</head>
<body>

<script>
/* =========================
   VARI√ÅVEIS GLOBAIS
========================= */
let player, enemies = [], bullets = [], fires = [], hearts = [];
let camX = 0, camY = 0;

let catIdle, catMove, catReload, catShoot, catNoAmmo;
let enemyIdle, enemyAttack, enemyFly, enemyFire, enemyHurt, enemyDeath;
let heartImg, bulletImg;

let ammo = 10;
let maxAmmo = 10;
let playerLife = 10;
let currentLevel = 1;

/* =========================
   PRELOAD (SPRITES)
========================= */
function preload() {
  // PLAYER
  catIdle   = loadImage("sprites/cat_idle.png");
  catMove   = loadImage("sprites/cat_move.png");
  catReload = loadImage("sprites/cat_reload.png");
  catShoot  = loadImage("sprites/cat_shooting.png");
  catNoAmmo = loadImage("sprites/cat_idle_noammo.png");

  // ENEMY
  enemyIdle   = loadImage("sprites/enemy_idle.png");
  enemyAttack = loadImage("sprites/enemy_attack.png");
  enemyFly    = loadImage("sprites/enemy_fly.png");
  enemyFire   = loadImage("sprites/enemy_fire.png");
  enemyHurt   = loadImage("sprites/enemy_hurt.png");
  enemyDeath  = loadImage("sprites/enemy_death.png");

  // ITEMS
  heartImg  = loadImage("sprites/heart.png");
  bulletImg = loadImage("sprites/hero_bullet.png");
}

/* =========================
   SETUP
========================= */
function setup() {
  createCanvas(windowWidth, windowHeight);
  player = {
    x: 400,
    y: 300,
    w: 48,
    h: 48,
    speed: 3
  };
  loadLevel(currentLevel);
}

/* =========================
   LEVELS
========================= */
function loadLevel(level) {
  enemies = [];
  hearts = [];

  let enemyCount = level + 2;

  for (let i = 0; i < enemyCount; i++) {
    enemies.push({
      x: random(200, 1200),
      y: random(200, 800),
      life: 5,
      fireCooldown: 0
    });
  }

  hearts.push({
    x: random(300, 1000),
    y: random(300, 700)
  });
}

/* =========================
   DRAW
========================= */
function draw() {
  background(10);

  camX = player.x - width / 2;
  camY = player.y - height / 2;

  push();
  translate(-camX, -camY);

  drawMaze();
  drawHearts();
  drawEnemies();
  drawFires();
  drawBullets();
  drawPlayer();

  pop();

  drawHUD();
}

/* =========================
   PLAYER
========================= */
function drawPlayer() {
  let moving = keyIsDown(65) || keyIsDown(68) || keyIsDown(87) || keyIsDown(83);

  if (ammo <= 0) {
    image(catNoAmmo, player.x, player.y, player.w, player.h);
  } else if (moving) {
    image(catMove, player.x, player.y, player.w, player.h);
  } else {
    image(catIdle, player.x, player.y, player.w, player.h);
  }

  if (keyIsDown(65)) player.x -= player.speed;
  if (keyIsDown(68)) player.x += player.speed;
  if (keyIsDown(87)) player.y -= player.speed;
  if (keyIsDown(83)) player.y += player.speed;
}

/* =========================
   TIRO
========================= */
function mousePressed() {
  if (ammo > 0) {
    bullets.push({
      x: player.x + 24,
      y: player.y + 24,
      dx: (mouseX - width / 2) * 0.05,
      dy: (mouseY - height / 2) * 0.05
    });
    ammo--;
  }
}

function drawBullets() {
  for (let i = bullets.length - 1; i >= 0; i--) {
    let b = bullets[i];
    b.x += b.dx;
    b.y += b.dy;
    image(bulletImg, b.x, b.y, 16, 16);

    for (let e of enemies) {
      if (dist(b.x, b.y, e.x, e.y) < 25) {
        e.life--;
        bullets.splice(i, 1);
        break;
      }
    }
  }
}

/* =========================
   ENEMY
========================= */
function drawEnemies() {
  for (let e of enemies) {
    let d = dist(player.x, player.y, e.x, e.y);

    if (d < 300) {
      e.x += (player.x - e.x) * 0.01;
      e.y += (player.y - e.y) * 0.01;
    }

    image(enemyFly, e.x, e.y, 48, 48);

    if (e.fireCooldown <= 0) {
      fires.push({
        x: e.x,
        y: e.y,
        dx: (player.x - e.x) * 0.03,
        dy: (player.y - e.y) * 0.03
      });
      e.fireCooldown = 120;
    } else {
      e.fireCooldown--;
    }
  }

  enemies = enemies.filter(e => e.life > 0);

  if (enemies.length === 0) {
    currentLevel++;
    loadLevel(currentLevel);
  }
}

/* =========================
   FIRE (INIMIGO)
========================= */
function drawFires() {
  for (let i = fires.length - 1; i >= 0; i--) {
    let f = fires[i];
    f.x += f.dx;
    f.y += f.dy;
    image(enemyFire, f.x, f.y, 20, 20);

    if (dist(f.x, f.y, player.x, player.y) < 25) {
      playerLife--;
      fires.splice(i, 1);
    }
  }
}

/* =========================
   HEART
========================= */
function drawHearts() {
  for (let i = hearts.length - 1; i >= 0; i--) {
    let h = hearts[i];
    image(heartImg, h.x, h.y, 32, 32);

    if (dist(player.x, player.y, h.x, h.y) < 30) {
      playerLife = min(10, playerLife + 1);
      hearts.splice(i, 1);
    }
  }
}

/* =========================
   HUD
========================= */
function drawHUD() {
  fill(255);
  textSize(16);
  text("‚ù§Ô∏è Vida: " + playerLife, 20, 30);
  text("üî´ Muni√ß√£o: " + ammo + "/" + maxAmmo, 20, 55);
  text("Fase: " + currentLevel, 20, 80);
}

/* =========================
   LABIRINTO SIMPLES
========================= */
function drawMaze() {
  stroke(80);
  strokeWeight(10);
  line(200, 100, 200, 800);
  line(500, 200, 900, 200);
  line(700, 400, 700, 900);
  noStroke();
}
</script>

</body>
</html>
