<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Mini Game do Amor üíñ</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
html,body{margin:0;padding:0;background:#000;overflow:hidden;font-family:Arial}
canvas{display:block;background:#111}
.btn{
 position:absolute;right:20px;bottom:40px;
 width:90px;height:90px;border-radius:50%;
 background:#ff3366;color:#fff;
 display:flex;align-items:center;justify-content:center;
 font-size:14px;font-weight:bold;
}
#reload{bottom:140px;background:#3399ff}
.joystick{position:absolute;left:20px;bottom:20px;width:120px;height:120px;border-radius:50%;background:rgba(255,255,255,.1)}
.stick{position:absolute;width:50px;height:50px;border-radius:50%;background:rgba(255,255,255,.4);left:35px;top:35px}
#menu{
 position:absolute;inset:0;
 display:flex;flex-direction:column;
 align-items:center;justify-content:center;
 background:#000;color:#fff;
}
#play{
 padding:20px 50px;border-radius:40px;
 background:#ff3366;font-size:26px;
 animation:pulse 1.5s infinite;
}
@keyframes pulse{
 0%{transform:scale(1)}
 50%{transform:scale(1.1)}
 100%{transform:scale(1)}
}
</style>
</head>

<body>

<div id="menu">
<h1>üíñ Mini Game do Amor üíñ</h1>
<div id="play">PLAY</div>
</div>

<canvas id="game"></canvas>

<div class="joystick" id="joy"><div class="stick"></div></div>
<div class="btn" id="shoot">ATIRAR</div>
<div class="btn" id="reload">RECARREGAR</div>

<audio id="music" src="music.mp3" loop></audio>

<script>
/* ===== CANVAS ===== */
const canvas=document.getElementById("game"),ctx=canvas.getContext("2d");
function resize(){canvas.width=innerWidth;canvas.height=innerHeight}
resize(); addEventListener("resize",resize);

const TILE=48, FRAME=32;

/* ===== LOAD ===== */
function load(src,f){let i=new Image();i.src=src;return{img:i,frames:f}}

const cat={
 idle:load("sprites/cat_idle.png",5),
 move:load("sprites/cat_move.png",8),
 shooting:load("sprites/cat_shooting.png",13),
 reload:load("sprites/cat_reload.png",41),
 hurt:load("sprites/cat_hurt.png",4),
 noammo:load("sprites/cat_noammo.png",5)
};

const enemyAnim={
 idle:load("sprites/enemy_idle.png",4),
 attack:load("sprites/enemy_attack.png",8),
 hurt:load("sprites/enemy_hurt.png",4),
 death:load("sprites/enemy_death.png",6)
};

const bulletImg=new Image(); bulletImg.src="sprites/hero_bullet.png";
const fireImg=new Image(); fireImg.src="sprites/enemy_fire.png";
const heartImg=new Image(); heartImg.src="sprites/heart.png";

/* ===== GAME STATE ===== */
let gameStarted=false;
let fase=parseInt(localStorage.getItem("fase"))||0;

/* ===== PLAYER ===== */
const player={
 px:96,py:96,state:"idle",frame:0,delay:0,
 hp:5,maxHp:5,
 ammo:10,maxAmmo:10,
 dirX:1,dirY:0
};

let enemies=[],bullets=[],fires=[];
let hearts=[{x:5,y:1},{x:9,y:7}];

/* ===== SPAWN ===== */
function spawnEnemies(){
 enemies=[];
 for(let i=0;i<=fase;i++){
  enemies.push({
   px:400+i*60,py:200,
   hp:5,alive:true,
   state:"idle",frame:0,delay:0,cd:60
  });
 }
}

/* ===== ANIMATION ===== */
function animate(e,set,s=6){
 let a=set[e.state]||set.idle;
 e.delay++;
 if(e.delay>s){e.frame=(e.frame+1)%a.frames;e.delay=0}
}
function draw(e,set){
 let a=set[e.state]||set.idle;
 ctx.drawImage(a.img,e.frame*FRAME,0,FRAME,FRAME,e.px,e.py,TILE,TILE);
}

/* ===== CONTROLS ===== */
let move={x:0,y:0};
const stick=document.querySelector(".stick");
joy.ontouchmove=e=>{
 let r=joy.getBoundingClientRect();
 let x=e.touches[0].clientX-r.left-60;
 let y=e.touches[0].clientY-r.top-60;
 x=Math.max(-40,Math.min(40,x));
 y=Math.max(-40,Math.min(40,y));
 stick.style.left=x+35+"px"; stick.style.top=y+35+"px";
 move.x=x/40; move.y=y/40;
};
joy.ontouchend=()=>{move.x=0;move.y=0;stick.style.left="35px";stick.style.top="35px"}

shoot.onclick=()=>{
 if(player.ammo<=0)return;
 player.ammo--;
 bullets.push({x:player.px+24,y:player.py+24,dx:player.dirX*8,dy:player.dirY*8});
};

reload.onclick=()=>{
 player.ammo=player.maxAmmo;
};

/* ===== ENEMY AI ===== */
function enemyAI(e){
 let dx=player.px-e.px, dy=player.py-e.py;
 let d=Math.hypot(dx,dy);
 if(d>40){e.px+=dx/d*1.2; e.py+=dy/d*1.2}
 e.cd--;
 if(e.cd<=0){
  e.cd=80;
  fires.push({x:e.px+24,y:e.py+24,dx:dx/d*4,dy:dy/d*4});
 }
}

/* ===== MENU ===== */
play.onclick=()=>{
 document.getElementById("menu").style.display="none";
 music.play();
 spawnEnemies();
 gameStarted=true;
};

/* ===== LOOP ===== */
function loop(){
 if(!gameStarted){requestAnimationFrame(loop);return;}
 ctx.clearRect(0,0,canvas.width,canvas.height);

 // PLAYER
 if(Math.abs(move.x)+Math.abs(move.y)>0.1){
  player.px+=move.x*3; player.py+=move.y*3;
  player.state="move"; player.dirX=move.x; player.dirY=move.y;
 } else player.state="idle";
 animate(player,cat); draw(player,cat);

 // ENEMIES
 enemies.forEach(e=>{
  if(!e.alive)return;
  enemyAI(e);
  animate(e,enemyAnim); draw(e,enemyAnim);
 });

 // BULLETS
 bullets.forEach((b,i)=>{
  b.x+=b.dx; b.y+=b.dy;
  ctx.drawImage(bulletImg,b.x,b.y,16,16);
  enemies.forEach(e=>{
   if(e.alive && Math.abs(b.x-e.px)<30 && Math.abs(b.y-e.py)<30){
    e.hp--; bullets.splice(i,1);
    if(e.hp<=0)e.alive=false;
   }
  });
 });

 // FIRE
 fires.forEach((f,i)=>{
  f.x+=f.dx; f.y+=f.dy;
  ctx.drawImage(fireImg,f.x,f.y,20,20);
  if(Math.abs(f.x-player.px)<28 && Math.abs(f.y-player.py)<28){
   player.hp--; fires.splice(i,1);
   if(player.hp<=0){
    localStorage.setItem("fase",fase);
    location.reload();
   }
  }
 });

 // HEART
 hearts.forEach((h,i)=>{
  ctx.drawImage(heartImg,h.x*TILE,h.y*TILE,24,24);
  if(Math.abs(player.px-h.x*TILE)<32){
   player.hp=Math.min(player.maxHp,player.hp+1);
   hearts.splice(i,1);
  }
 });

 // HUD
 for(let i=0;i<player.hp;i++)
 ctx.drawImage(heartImg,20+i*28,20,24,24);

 // NEXT FASE
 if(enemies.every(e=>!e.alive)){
  fase++;
  localStorage.setItem("fase",fase);
  if(fase>=5){
   alert("üéâ Feliz Anivers√°rio, meu amor üíñ\nEsse jogo √© s√≥ um pedacinho do quanto eu te amo ‚ù§Ô∏è");
   localStorage.clear();
   return;
  }
  spawnEnemies();
 }

 requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
