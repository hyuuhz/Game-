<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Maze of Our Love ❤️</title>

<style>
html, body {
  margin: 0;
  padding: 0;
  width: 100%;
  height: 100%;
  background: black;
  overflow: hidden;
}

canvas {
  width: 100vw;
  height: 100vh;
  display: block;
}

#playBtn {
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%) scale(1);
  padding: 20px 60px;
  font-size: 32px;
  border: none;
  border-radius: 20px;
  background: #ff4d6d;
  color: white;
  cursor: pointer;
  animation: pulse 1.5s infinite;
}

@keyframes pulse {
  0% { transform: translate(-50%, -50%) scale(1); }
  50% { transform: translate(-50%, -50%) scale(1.1); }
  100% { transform: translate(-50%, -50%) scale(1); }
}
</style>
</head>

<body>

<button id="playBtn">PLAY</button>
<canvas id="game"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

function resizeCanvas() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
resizeCanvas();
window.addEventListener("resize", resizeCanvas);
window.addEventListener("orientationchange", resizeCanvas);

let gameState = "menu";
let level = 1;

const keys = {};
document.addEventListener("keydown", e => keys[e.key] = true);
document.addEventListener("keyup", e => keys[e.key] = false);

//////////////// HERO //////////////////
const heroSprites = {
  idle:{src:"sprites/cat_idle.png",frames:5},
  move:{src:"sprites/cat_move.png",frames:8},
  hurt:{src:"sprites/cat_hurt.png",frames:4},
  noammo:{src:"sprites/cat_noammo.png",frames:5},
  reload:{src:"sprites/cat_reload.png",frames:41},
  shooting:{src:"sprites/cat_shooting.png",frames:13}
};

for(let k in heroSprites){
  heroSprites[k].img = new Image();
  heroSprites[k].img.src = heroSprites[k].src;
}

const hero = {
  x: 100, y: 200, w: 64, h: 64,
  speed: 3,
  life: 5, maxLife: 5,
  ammo: 10, maxAmmo: 10,
  state: "idle",
  frame: 0, tick: 0, fs: 5
};

//////////////// ENEMY //////////////////
const enemySprites = {
  idle:{src:"sprites/enemy_idle.png",frames:4},
  flying:{src:"sprites/enemy_fly.png",frames:4},
  attack:{src:"sprites/enemy_attack.png",frames:8},
  hurt:{src:"sprites/enemy_hurt.png",frames:4},
  death:{src:"sprites/enemy_death.png",frames:6},
  projectile:{src:"sprites/enemy_fire.png",frames:1}
};

for(let k in enemySprites){
  enemySprites[k].img = new Image();
  enemySprites[k].img.src = enemySprites[k].src;
}

let enemies = [];
function spawnEnemies() {
  enemies = [];
  for (let i = 0; i < level + 1; i++) {
    enemies.push({
      x: canvas.width - 200 - i * 80,
      y: 150 + i * 60,
      w: 64, h: 64,
      life: 5,
      state: "idle",
      frame: 0, tick: 0, fs: 6,
      cd: 80
    });
  }
}

//////////////// BULLETS //////////////////
const heroBullets = [];
const enemyBullets = [];

//////////////// LIFE PICKUP //////////////////
const heartImg = new Image();
heartImg.src = "sprites/heart.png";
let hearts = [{x:400,y:300}];

//////////////// MOBILE INPUT //////////////////
let shoot = false;
canvas.addEventListener("touchstart", e => {
  if (e.touches[0].clientX > canvas.width / 2) shoot = true;
});
canvas.addEventListener("touchend", () => shoot = false);

//////////////// MENU //////////////////
document.getElementById("playBtn").onclick = () => {
  gameState = "fade";
  setTimeout(() => {
    gameState = "game";
    spawnEnemies();
    document.getElementById("playBtn").style.display = "none";
  }, 700);
};

//////////////// GAME LOOP //////////////////
function gameLoop() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  if (gameState === "menu") {
    drawTitle();
    requestAnimationFrame(gameLoop);
    return;
  }

  if (gameState === "fade") {
    ctx.fillStyle = "rgba(0,0,0,0.15)";
    ctx.fillRect(0,0,canvas.width,canvas.height);
    requestAnimationFrame(gameLoop);
    return;
  }

  updateHero();
  updateEnemies();
  updateBullets();

  drawLabyrinth();
  drawHearts();
  drawHero();
  drawEnemies();
  drawUI();

  if (enemies.length === 0) {
    level++;
    if (level > 5) {
      drawFinalMessage();
      return;
    }
    spawnEnemies();
  }

  requestAnimationFrame(gameLoop);
}
gameLoop();

//////////////// FUNCTIONS //////////////////
function drawTitle() {
  ctx.fillStyle = "#fff";
  ctx.font = "48px Arial";
  ctx.textAlign = "center";
  ctx.fillText("Maze of Our Love ❤️", canvas.width/2, canvas.height/2 - 100);
}

function updateHero() {
  let moving = false;
  if (keys["a"]) { hero.x -= hero.speed; moving = true; }
  if (keys["d"]) { hero.x += hero.speed; moving = true; }
  if (keys["w"]) { hero.y -= hero.speed; moving = true; }
  if (keys["s"]) { hero.y += hero.speed; moving = true; }

  hero.state = moving ? "move" : "idle";

  if ((keys[" "] || shoot) && hero.ammo > 0) {
    hero.state = "shooting";
    heroBullets.push({x: hero.x+32, y: hero.y+32, vx: 6});
    hero.ammo--;
  }

  if (keys["r"]) {
    hero.state = "reload";
    hero.ammo = hero.maxAmmo;
  }

  animate(hero, heroSprites);
}

function updateEnemies() {
  enemies.forEach((e, ei) => {
    const dx = hero.x - e.x;
    const dy = hero.y - e.y;
    const d = Math.hypot(dx, dy);

    if (d < 300) {
      e.state = "flying";
      e.x += Math.sign(dx) * 1.3;
      e.y += Math.sign(dy) * 1.3;

      e.cd--;
      if (e.cd <= 0) {
        enemyBullets.push({
          x: e.x+32, y: e.y+32,
          vx: Math.sign(dx)*4,
          vy: Math.sign(dy)*4
        });
        e.cd = 90;
      }
    } else e.state = "idle";

    animate(e, enemySprites);

    heroBullets.forEach((b, bi) => {
      if (hit(b, e)) {
        e.life--;
        heroBullets.splice(bi,1);
        if (e.life <= 0) enemies.splice(ei,1);
      }
    });
  });
}

function updateBullets() {
  heroBullets.forEach(b => b.x += b.vx);
  enemyBullets.forEach((b, bi) => {
    b.x += b.vx;
    b.y += b.vy;
    if (hit(b, hero)) {
      hero.life--;
      enemyBullets.splice(bi,1);
      if (hero.life <= 0) {
        hero.life = hero.maxLife;
        hero.ammo = hero.maxAmmo;
        spawnEnemies();
      }
    }
  });
}

function drawHero() { drawSprite(hero, heroSprites); }
function drawEnemies() { enemies.forEach(e => drawSprite(e, enemySprites)); }

function drawSprite(o, sprites) {
  const sp = sprites[o.state];
  ctx.drawImage(sp.img, o.frame*64, 0, 64, 64, o.x, o.y, 64, 64);
}

function animate(o, sprites) {
  o.tick++;
  if (o.tick > o.fs) {
    o.tick = 0;
    o.frame++;
    if (o.frame >= sprites[o.state].frames) o.frame = 0;
  }
}

function hit(a, b) {
  return a.x < b.x + b.w &&
         a.x + 10 > b.x &&
         a.y < b.y + b.h &&
         a.y + 10 > b.y;
}

function drawLabyrinth() {
  ctx.strokeStyle = "#333";
  ctx.strokeRect(40, 40, canvas.width-80, canvas.height-80);
}

function drawUI() {
  ctx.fillStyle = "red";
  ctx.fillRect(20, 20, hero.life * 30, 12);
  ctx.fillStyle = "yellow";
  ctx.fillRect(20, 40, hero.ammo * 15, 10);
}

function drawHearts() {
  hearts.forEach((h, hi) => {
    ctx.drawImage(heartImg, h.x, h.y, 32, 32);
    if (hit(hero, h)) {
      hero.life = Math.min(hero.maxLife, hero.life + 1);
      hearts.splice(hi,1);
    }
  });
}

function drawFinalMessage() {
  ctx.fillStyle = "#fff";
  ctx.font = "42px Arial";
  ctx.textAlign = "center";
  ctx.fillText("Happy Birthday ❤️", canvas.width/2, canvas.height/2 - 40);
  ctx.fillText("I Love You Forever", canvas.width/2, canvas.height/2 + 20);
}
</script>

</body>
</html>
